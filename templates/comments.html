{% extends 'base.html' %}
{% block content %}

<div id="comment-page-wrapper">

<ul class="list-unstyled">
	<li class="media sub-post">
		<img class="mr-3 comment-image" src="{{ url_for('static', filename='globe.png') }}">
		<div class="media-body">
			<div class="row post-row row-space">
				<div class="col inner-div">
					<small><a class="user-icon-link" href="{{ url }}/u/{{ post['author'] }}"><i class="fa fa-user "></i>{{ post.author }}</a></small>
					<small><a class="top-of-post top-post-sublink" href="{{ config.URL }}/r/{{ post.sub }}">/r/{{ post.sub }}</a></small>
					<small class="created-ago">{{ post.created_ago }}</small>
				</div>
			</div>
    <div class="comment-post-title">
    <a class="sub-post-title-link" href="{{ post.url }}">{{ post.title }}</a> 
    <small><a href="{{ post.url }}" class="sub-post-title-url">({{ post.remote_url_parsed }})</a></small>
    </div>
			<div class="row post-row comment-bottom">
<div class="inner-div comment-post-voting" vote-obj-id="{{ post.id }}" vote-obj-type="post" vote-userid="session['user_id']" has_voted="{{ post.has_voted }}">
	{% if post.has_voted == 1 %}
	<a href="javascript:void(0)"><i style="color: orange;"class="fa fa-arrow-up"></i></a>
	{% else %}
	<a href="javascript:void(0)"><i class="fa fa-arrow-up"></i></a>
	{% endif %}
	<vote class="score">{{ post.ups - post.downs }}</vote>
	{% if post.has_voted == -1 %}
	<a href="javascript:void(0)"><i style="color: lightblue;" class="fa fa-arrow-down"></i></a>
	{% else %}
	<a href="javascript:void(0)"><i class="fa fa-arrow-down"></i></a>
	{% endif %}
</div>
			<div class="inner-div">
				<a class="comment-link" href="{{ config.URL }}/r/{{ post.sub }}/{{ post.id }}/{{ post.inurl_title }}/">{{ post.comment_count }} comments</a>
			</div>
			</div>
		</div>
</li>
</ul>
<div id="row">
	<unstyled> sort by: </unstyled>
	{% if not parent_comment.id %}
	<a class="comment-link" href="{{ post_url }}sort-top"><small>top</small></a>
	<unstyled><small>|</small></unstyled>
	<a class="comment-link" href="{{ post_url }}sort-new"><small>new</small></a>
	{% else %}
	<a class="comment-link" href="{{ post_url }}{{ parent_comment.id }}/sort-top"><small>top</small></a>
	<unstyled><small>|</small></unstyled>
	<a class="comment-link" href="{{ post_url }}{{ parent_comment.id }}/sort-new"><small>new</small></a>
	{% endif %}
</div>
{% if not parent_comment.id %}
<form id='post-reply-box' action='/create_comment' method='POST'>
	<div class="comment-reply-box-wrapper">
		<textarea class="comment-reply-box-expand" name="comment_text"></textarea>
	</div>
	<input type='hidden' name='post_id' value='{{ post_id }}'>
	<input type='hidden' name='post_url' value='{{ post_url }}'>
	<input type='hidden' name='sub_name' value='{{ post.sub }}'>
	<input class="post-text-area-button" type='submit' value='new comment'>
</form>

<form id='comment-reply-box' action='/create_comment' method='POST' style="display: none;">
	<br>
	<div class="comment-reply-box-wrapper">
		<textarea class="comment-reply-box-expand" name="comment_text"></textarea>
	</div>
	<input type='hidden' name='post_id' value='{{ post_id }}'>
	<input type='hidden' name='post_url' value='{{ post_url }}{{ parent_comment.id }}'>
	<input type='hidden' name='sub_name' value='{{ post.sub }}'>
	<input type='hidden' name='parent_id' id='parent_id'>
	<input class="comment-text-area-button" type='submit' value='reply'>
</form>
{% endif %}


<ul class="list-unstyled">
	{%- for comment, value in tree.items() recursive %}  
	{% if loop.depth0 < 5 %}
	<li class="media sub-comment media-body" style="margin-left:{{ loop.depth - 1 }}rem">
		<div class='media-body comment-media-body'>
		<div class="row post-row">
			<div class="col inner-div">
    		<i class="fa fa-user"></i> <a class="user-icon-link" href="{{ config.URL }}/u/{{ comment.author }}">{{ comment.author }}</a>
            <a href="{{ config.URL }}/r/{{ post.sub }}/{{ post.id }}/{{ post.inurl_title }}/{{ comment.id }}/">
            	<small class="created-ago comment-link">{{ comment.created_ago }}</small>
            </a>
			{% if comment.parent_id != None %}
            <a class="comment-link" href="{{ config.URL }}/r/{{ post.sub }}/{{ post.id }}/{{ post.inurl_title }}/{{ comment.parent_id }}/">
            {% else %}
            <a class="comment-link" href="{{ config.URL }}/r/{{ post.sub }}/{{ post.id }}/{{ post.inurl_title }}/">
           	{% endif %}
            	<small class="created-ago">parent</small>
            </a>
			</div>
		</div>
		<div clss="comment-text">
		<p class="comment-text-text">{{ comment.text }}</p>
	</div>
			<div class="row post-row comment-bottom">

<div class="inner-div comment-voting" vote-obj-id="{{ comment.id }}" vote-obj-type="comment" vote-userid="session['user_id']" has_voted="{{ comment.has_voted }}">
	{% if comment.has_voted == 1 %}
	<a href="javascript:void(0)"><i style="color: orange;"class="fa fa-arrow-up"></i></a>
	{% else %}
	<a href="javascript:void(0)"><i class="fa fa-arrow-up"></i></a>
	{% endif %}
	<vote class="score">{{ comment.ups - comment.downs }}</vote>
	{% if comment.has_voted == -1 %}
	<a href="javascript:void(0)"><i style="color: lightblue;" class="fa fa-arrow-down"></i></a>
	{% else %}
	<a href="javascript:void(0)"><i class="fa fa-arrow-down"></i></a>
	{% endif %}
</div>
			<div class="inner-div">
				<a class="comment-link comment-reply" href="javascript:void(0)" comment_id="{{ comment.id }}">reply</a>
				{% if loop.depth0 == 4 and value|length > 0 %}
					<a class="comment-link  comment-more" href="{{ config.URL }}/r/{{ post.sub }}/{{ post.id }}/{{ post.inurl_title }}/{{ comment.id }}/">
						more>>
					</a>
				{% endif %}
			</div>
			</div>
	{% if parent_comment.id and loop.index0 == 0 and loop.depth0 == 0 %}
<form id='comment-reply-box' action='/create_comment' method='POST' style="display: block;">
	<br>
	<div class="comment-reply-box-wrapper">
		<textarea class="comment-reply-box-expand" name="comment_text"></textarea>
	</div>
	<input type='hidden' name='post_id' value='{{ post_id }}'>
	<input type='hidden' name='post_url' value='{{ post_url }}{{ parent_comment.id }}'>
	<input type='hidden' name='parent_id' id='parent_id' value='{{ parent_comment.id }}'>
	<input type='hidden' name='sub_name' value='{{ post.sub }}'>
	<input class="comment-text-area-button" type='submit' value='reply'>
</form>
	{% endif %}
	</div>
	</li> 

	{%- if value %}
	{{ loop(value.items()) }}
	{% endif %}
	{% endif %}
	{% else %}
	<p>no comments</p>
	{%- endfor %}
</ul>
</div>
{% endblock %} 